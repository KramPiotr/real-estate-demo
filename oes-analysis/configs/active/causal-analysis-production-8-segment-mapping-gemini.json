{
    "transcripts_directory": "test-transcripts",
    "output_directory": "multi_agent_responses",
    "input_catalog": {
        "name": "behaviour",
        "location": "causals",
        "types": [
            "opportunity","definition","special","special2","special3"
        ]
    },
    "nodes": [
        {
            "name": "trigger_identification",
            "inputs": [
                "transcript",
                "behaviour-opportunity"
            ],
            "models": [
                {
                    "provider": "gemini"
                }
            ],
            "response_format_schema": {
                "type": "object",
                "properties": {
                    "enrolment_closing": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "id": {
                                        "type": "integer",
                                        "description": "Unique opportunity ID (must be integer)"
                                    },
                                    "title": {"type": "string"},
                                    "opportunity_score": {"type": "number"},
                                    "opportunity": {"type": "string"}
                                },
                                "required": ["id", "title", "opportunity_score", "opportunity"]
                            }
                        }
                    }
                },
                "required": ["enrolment_closing"]
            }
        },
        {
            "name": "response_analysis",
            "inputs": [
                "transcript",
                "behaviour-opportunity",
                "trigger_identification"
            ],
            "models": [
                {
                    "provider": "gemini"
                }
            ],
            "response_format_schema": {
                "type": "object",
                "properties": {
                    "enrolment_closing": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "id": {
                                        "type": "integer",
                                        "description": "Unique opportunity ID (must be integer)"
                                    },
                                    "title": {"type": "string"},
                                    "opportunity_score": {
                                        "type": "number",
                                        "description": "Numeric score between 0-5"
                                    },
                                    "response_score": {
                                        "type": "number",
                                        "description": "Numeric score between 0-5"
                                    },
                                    "tag": {
                                        "type": "string",
                                        "enum": ["positive", "negative"]
                                    },
                                    "opportunity": {"type": "string"},
                                    "response": {"type": "string"}
                                },
                                "required": ["id", "title", "opportunity_score", "response_score", "tag", "opportunity", "response"]
                            }
                        }
                    }
                },
                "required": ["enrolment_closing"]
            }
        },
        {
            "name": "recommended_improvement",
            "inputs": [
                "transcript",
                "behaviour-definition",
                "response_analysis"
            ],
            "models": [
                {
                    "provider": "gemini"
                }
            ],
            "response_format_schema": {
                "type": "object",
                "properties": {
                    "enrolment_closing": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "id": {
                                        "type": "integer",
                                        "description": "Unique opportunity ID (must be integer)"
                                    },
                                    "title": {"type": "string"},
                                    "opportunity_score": {
                                        "type": "number",
                                        "description": "Numeric score between 0-5"
                                    },
                                    "response_score": {
                                        "type": "number",
                                        "description": "Numeric score between 0-5"
                                    },
                                    "tag": {
                                        "type": "string",
                                        "enum": ["positive", "negative"]
                                    },
                                    "opportunity": {"type": "string"},
                                    "response": {"type": "string"},
                                    "recognition": {"type": "string"},
                                    "recommendation": {"type": "string"}
                                },
                                "required": ["id", "title", "opportunity_score", "response_score", "tag", "opportunity", "response"]
                            }
                        }
                    }
                },
                "required": ["enrolment_closing"]
            }
        },
        {
            "name": "behaviour_first",
            "inputs": [
                "transcript",
                "behaviour-special",
                "recommended_improvement"
            ],
            "models": [
                {
                    "provider": "gemini"
                }
            ],
            "response_format_schema": {
                "type": "object",
                "properties": {
                    "recommended_improvement": {
                        "type": "object",
                        "properties": {
                            "model_outputs": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "additionalProperties": {
                                        "type": "object",
                                        "additionalProperties": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "id": {
                                                        "type": "integer",
                                                        "description": "Unique opportunity ID (must be integer)"
                                                    }
                                                },
                                                "required": ["id"]
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        {
            "name": "behaviour_second",
            "inputs": [
                "transcript",
                "behaviour-special2",
                "behaviour_first"
            ],
            "models": [
                {
                    "provider": "gemini"
                }
            ],
            "response_format_schema": {
                "type": "object",
                "properties": {
                    "recommended_improvement": {
                        "type": "object",
                        "properties": {
                            "model_outputs": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "additionalProperties": {
                                        "type": "object",
                                        "additionalProperties": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "id": {
                                                        "type": "integer",
                                                        "description": "Unique opportunity ID (must be integer)"
                                                    }
                                                },
                                                "required": ["id"]
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        {
            "name": "behaviour_third",
            "inputs": [
                "transcript",
                "behaviour-special3",
                "behaviour_second"
            ],
            "models": [
                {
                    "provider": "gemini"
                }
            ],
            "response_format_schema": {
                "type": "object",
                "properties": {
                    "recommended_improvement": {
                        "type": "object",
                        "properties": {
                            "model_outputs": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "additionalProperties": {
                                        "type": "object",
                                        "additionalProperties": {
                                            "type": "array",
                                            "items": {
                                                "type": "object",
                                                "properties": {
                                                    "id": {
                                                        "type": "integer",
                                                        "description": "Unique opportunity ID (must be integer)"
                                                    }
                                                },
                                                "required": ["id"]
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        {
            "name": "response_validation",
            "inputs": [
                "transcript",
                "behaviour-opportunity",
                "behaviour-definition",
                "behaviour_third"
            ],
            "models": [
                {
                    "provider": "gemini"
                }
            ],
            "response_format_schema": {
                "type": "object",
                "properties": {
                    "call_id": {"type": "string"},
                    "enrolment_closing": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "id": {
                                        "type": "integer",
                                        "description": "Unique opportunity ID (must be integer)"
                                    }
                                },
                                "required": ["id"]
                            }
                        }
                    }
                },
                "required": ["call_id", "enrolment_closing"]
            }
        },
        {
            "name": "response_accuracy",
            "inputs": [
                "transcript",
                "response_validation"
            ],
            "models": [
                {
                    "provider": "gemini"
                }
            ],
            "response_format_schema": {
                "type": "object",
                "properties": {
                    "call_id": {"type": "string"},
                    "enrolment_closing": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "id": {
                                        "type": "integer",
                                        "description": "Unique opportunity ID (must be integer)"
                                    }
                                },
                                "required": ["id"]
                            }
                        }
                    }
                },
                "required": ["call_id", "enrolment_closing"]
            }
        },
        {
            "name": "condense_analysis",
            "inputs": [
                "transcript",
                "behaviour-opportunity",
                "behaviour-definition",
                "response_accuracy"
            ],
            "models": [
                {
                    "provider": "gemini",
                    "max_output_tokens": 20000
                }
            ],
            "response_format_schema": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "12-digit call identifier"
                    },
                    "opportunities": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "pattern_name": {
                                    "type": "string",
                                    "description": "Pattern type (e.g., 'closing_behaviors', 'objection_handling')"
                                },
                                "component_name": {
                                    "type": "string",
                                    "description": "Component name (e.g., 'teaching_period_confirmation', 'confidence_issues')"
                                },
                                "id": {
                                    "type": "integer",
                                    "description": "Unique opportunity ID"
                                },
                                "title": {
                                    "type": "string",
                                    "description": "Opportunity title from previous layer"
                                },
                                "opportunity_score": {
                                    "type": "string",
                                    "description": "Opportunity quality score (e.g., '4.7/5')"
                                },
                                "response_score": {
                                    "type": "string",
                                    "description": "Consultant response quality score (e.g., '2.8/5')"
                                },
                                "tag": {
                                    "type": "string",
                                    "enum": ["negative", "positive"],
                                    "description": "Overall effectiveness tag"
                                },
                                "segment_id_start": {
                                    "type": "integer",
                                    "description": "Starting segment ID where this opportunity occurred in the transcript"
                                },
                                "segment_id_end": {
                                    "type": "integer",
                                    "description": "Ending segment ID where this opportunity occurred in the transcript"
                                },
                                "condensed_opportunity_headline": {
                                    "type": "string",
                                    "description": "Punchy 1-2 sentence headline describing the opportunity"
                                },
                                "condensed_opportunity_quote": {
                                    "type": "string",
                                    "description": "Student quote that triggered the opportunity, wrapped in << >>"
                                },
                                "condensed_response_quote": {
                                    "type": "string",
                                    "description": "Consultant's actual response quote, wrapped in << >>"
                                },
                                "condensed_actual_response": {
                                    "type": "string",
                                    "description": "3-4 sentence analysis of what consultant actually did"
                                },
                                "condensed_recommended_response": {
                                    "type": "string",
                                    "description": "REQUIRED when tag is 'negative': recommended alternative approach with example quotes in << >>. OMIT when tag is 'positive'."
                                },
                                "condensed_why_this_was_good": {
                                    "type": "string",
                                    "description": "REQUIRED when tag is 'positive': explanation of why the response was effective. OMIT when tag is 'negative'."
                                },
                                "detailed_opportunity_headline": {
                                    "type": "string",
                                    "description": "Expanded 2-3 sentence headline with more context"
                                },
                                "detailed_opportunity_quote": {
                                    "type": "string",
                                    "description": "Extended student quote with more context, wrapped in << >>"
                                },
                                "detailed_response_quote": {
                                    "type": "string",
                                    "description": "Extended consultant response quote with context, wrapped in << >>"
                                },
                                "detailed_actual_response": {
                                    "type": "string",
                                    "description": "Comprehensive analysis of consultant's behavior and effectiveness"
                                },
                                "detailed_recommended_response": {
                                    "type": "string",
                                    "description": "REQUIRED when tag is 'negative': detailed recommended approach with specific alternative phrasing in << >>. OMIT when tag is 'positive'."
                                },
                                "detailed_why_this_was_good": {
                                    "type": "string",
                                    "description": "REQUIRED when tag is 'positive': detailed explanation of effective execution. OMIT when tag is 'negative'."
                                }
                            },
                            "required": [
                                "pattern_name",
                                "component_name",
                                "id",
                                "title",
                                "opportunity_score",
                                "response_score",
                                "tag",
                                "segment_id_start",
                                "segment_id_end",
                                "condensed_opportunity_headline",
                                "condensed_opportunity_quote",
                                "condensed_response_quote",
                                "condensed_actual_response",
                                "detailed_opportunity_headline",
                                "detailed_opportunity_quote",
                                "detailed_response_quote",
                                "detailed_actual_response"
                            ]
                        }
                    }
                },
                "required": ["call_id", "opportunities"],
                "additionalProperties": false
            }
        },
        {
            "name": "ideal_response_generation",
            "inputs": [
                "transcript",
                "behaviour-opportunity",
                "behaviour-definition",
                "condense_analysis"
            ],
            "models": [
                {
                    "provider": "gemini",
                    "max_output_tokens": 20000
                }
            ],
            "response_format_schema": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "12-digit call identifier"
                    },
                    "opportunities": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "id": {
                                    "type": "integer",
                                    "description": "Opportunity ID matching the condense_analysis layer"
                                },
                                "ideal_response_template": {
                                    "type": "string",
                                    "description": "Comprehensive prescriptive coaching guidance on the ideal consultant response, written as a flowing narrative that covers what to say, how to structure it, what to include/avoid, and why each element matters for enrollment momentum"
                                },
                                "condensed_ideal_response_template": {
                                    "type": "string",
                                    "description": "Concise version (~100 words max) of the ideal response template, retaining key actionable guidance with example quotes in << >>, structural sequencing, and why it matters"
                                }
                            },
                            "required": ["id", "ideal_response_template", "condensed_ideal_response_template"]
                        }
                    }
                },
                "required": ["call_id", "opportunities"],
                "additionalProperties": false
            }
        },
        {
            "name": "generate_examples",
            "inputs": [
                "behaviour-opportunity",
                "behaviour-definition",
                "condense_analysis",
                "ideal_response_generation"
            ],
            "models": [
                {
                    "provider": "gemini",
                    "max_output_tokens": 20000
                }
            ],
            "response_format_schema": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "12-digit call identifier"
                    },
                    "opportunities": {
                        "type": "array",
                        "items": {
                            "type": "object",
                            "properties": {
                                "id": {
                                    "type": "integer",
                                    "description": "Opportunity ID matching previous layers"
                                },
                                "opportunity_summary": {
                                    "type": "string",
                                    "description": "Comprehensive scenario explanation covering: when this opportunity arises, what pattern/component it belongs to, what the student's underlying concerns or motivations are, why this is a critical juncture, what opportunity score indicates, and what the consultant's role should be in this situation"
                                },
                                "examples": {
                                    "type": "array",
                                    "items": {
                                        "type": "object",
                                        "properties": {
                                            "quote": {
                                                "type": "string",
                                                "description": "A realistic student quote that would trigger this exact opportunity type. Should be contextually diverse (different programs, intakes, concerns) but all trigger the same underlying opportunity pattern."
                                            }
                                        },
                                        "required": ["quote"]
                                    },
                                    "minItems": 5,
                                    "maxItems": 5,
                                    "description": "Exactly 5 diverse, realistic student quotes that would trigger this opportunity"
                                }
                            },
                            "required": ["id", "opportunity_summary", "examples"]
                        }
                    }
                },
                "required": ["call_id", "opportunities"],
                "additionalProperties": false
            }
        }
    ]
}